var guid;!function(e){"use strict";(e.NSSS=e.NSSS||{}).chromeGlobal=function(e,s){var a={},r=e.logger,d=(e.utils,e.settings,s.helperUtils),c=s.uiHelper,t=s.nfmEvents,n=e.utils.isNil,S=e.utils.isntNil,i=s.constants,l=(s.globalSettings,s.webProtection),o=(s.wpsHelperUtils,e.localizer),E=(s.uiConstants.MESSAGES,e.extensionAdapter);s.uiConstants.BLOCKPAGE.TYPE;let u=s.NSSSHelper;const R=e.constants.BROWSER_TYPE,g=s.uiConstants;var m=SafeWeb.Rating.SITE_RATING;const T=s.telemetryWrapper;return a.THREE_IN_ONE_EXTENSION=!1,a.updatePopoverUI=function(o){E.getActiveTab(async function(a){var t=E.getLastError();if(S(t))return r.log("Tab is not available"),void r.log(t);var t=E.getTabID(a),n=await s.extensionURLValidator.isNortonExtensionURL(a.url),i=e.localizer.getCurrentLanguageDirection(),l=u.isBlockPage(a.url);if(n&&!l){n={annoyanceThreats:0,computerThreats:0,identityThreats:0,rating:1,ratingText:e.localizer.getLocalizedString("Safe"),showSafeWebSearchbox:!1,sitename:a.url,totalThreats:0},l=s.main.popoverWindowStrings(1);o({popoverStrings:l,uiStatus:n,showReportSite:!1,showFullReport:!1,direction:i})}else{l=d.getSessionIDForTabID(t),n=c.uiStatusForSessionID(l,a.url);let e=n.uiStatus;e.customizedRating=s.chromeGlobal._getSiteRating(n.siteRating);t=s.main.popoverWindowStrings(e.rating,n.siteRating),l=n.showFullReport,a={popoverStrings:t,uiStatus:e,showReportSite:!1,showFullReport:l,direction:i};o(a)}})},a._getSiteRating=a=>{if(!n(a)){let e=null;switch(a){case m.SW_REGIONAL_BLOCK:e="suspiciousRegionBlock";break;case i.FORMJACK_PROTECTION.SITE_RATING.FORMJACK_STATE:e="formjackProtection"}return e}},a.downloadURLAnalyzedCallback=function(a,e,t){var n=t.getRating();if(S(n.redirectPage)){chrome.downloads.cancel(a),chrome.downloads.removeFile(a);chrome.downloads.erase({id:a});var a=o.getLocalizedString("Malicious Download Detected"),i=o.getLocalizedString("Download Cancelled");chrome.notifications.create({type:"basic",iconUrl:E.getExtensionURL("content/images/icon-downloadblocked.svg"),title:a,message:i});let e=!1;S(t._safeWebResult)&&S(t._safeWebResult.finalRedirectedTabUrl)&&(e=d.isRatingForFinalRedirectedUrl(t._safeWebResult));a=s.main.getParentUrlForDownloadBlock(n.url);T.sendDownloadBlockTelemetry(n.url,e,a)}},a.initialize=function(){E.isManifestV3Extension()&&!0===a.THREE_IN_ONE_EXTENSION&&d.handleOmniSearch(),l.registerEventCallback(t.PAGE_ANALYZED,s.main.pageAnalyzedCallback),l.registerEventCallback(t.SEARCH_URLS_ANALYZED,s.main.searchURLsAnalyzedCallback),e.globals.BROWSER===e.constants.BROWSER_TYPE.FIREFOX&&g.EXTENSION_TYPE===g.THREE_IN_ONE||s.main.handleTelemetryOptOut(),!0===a.THREE_IN_ONE_EXTENSION&&(s.globalSettings.getValue(i.IS_HP_FIRST_LAUNCH),E.isManifestV3Extension()||chrome.webRequest.onBeforeRequest.addListener(s.main.handleOmniSearchEvent,{urls:[s.constants.SEARCH_URL+"?omnisearch=yes*"]},["blocking"]),s.main.initVendorConstants()),E.isManifestV3Extension()||s.isFreshInstall||s.init.updateAntiTrackerStatus(),e.globals.BROWSER!==R.CHROME&&e.globals.BROWSER!==R.FIREFOX||E.getActiveTab(e=>{n(e)||n(e.id)}),s.isFreshInstall||(e.globals.BROWSER===R.EDGE?E.getAllTabs(e=>{e.forEach(e=>{var a;u.isLandingPageURL(e.url)&&(a=E.getTabID(e),E.updateTabUrl(a,e.url))})}):s.main.injectWebCommunication())},a._alarmHandler=async function(e){switch(await s.init.ready(),e){case i.ALARM_NAMES.FETCH_ANTI_TRACKER_STATUS:case i.ALARM_NAMES.PERIODIC_ANTI_TRACKER_SCHEDULER:s.antiTrackerStatusProvider.handleAntiTrackerScheduler(e);break;case i.ALARM_NAMES.TELEMETRY_NOTIFICATION:s.main.setTelemetryNotification();break;case i.ALARM_NAMES.FORMJACK_TOUR_SCHEDULER:s.formjackTourBG.handleTourDisplayScheduler(e)}},a._alarmCallback=e=>{a._alarmHandler(e.name)},a._addEventListeners=()=>{e.alarmHelper.registerAlarmListener(a._alarmCallback),E.addTabRemovedEventListener(s.main.handleClose),E.addTabActivatedEventListener(s.main.handleActivate),E.addTabUpdatedEventListener(s.main.handleOnUpdated),E.addMessageListener(s.main.handleMessage),S(chrome.downloads)&&(chrome.downloads.onCreated.addListener(s.main.analyzeDownloadPage),l.registerEventCallback(t.DOWNLOAD_URL_ANALYZED,a.downloadURLAnalyzedCallback))},a.load=function(){a._addEventListeners(),chrome.webNavigation.onTabReplaced.addListener(s.main.handleTabReplaced),s.init.ready().then(a.initialize,function(e){r.error(e)})},a.loadExtension=async function(){E.isManifestV3Extension()||await u.waitForWindowLoadEvent(),a.load()},a}(e.SymBfw,e.NSSS)}(executionContext),SymBfw.utils.isntNil(chrome.runtime.onInstalled)?chrome.runtime.onInstalled.addListener(NSSS.main.handleInstall):(guid=NSSS.globalSettings.getValue(NSSS.constants.NSSS_INSTALLDATEKEY),SymBfw.utils.isNil(guid)&&setTimeout(function(){NSSS.main.handleInstall({reason:"install"})},5e3)),NSSS.chromeGlobal.loadExtension();