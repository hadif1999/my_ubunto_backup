!function(e){"use strict";(e.SafeWeb=e.SafeWeb||{}).constants=(e.SymBfw,{SHASTA_URL:"https://ratings-wrs.norton.com",SHASTA_LOOKUP_PATH:"brief",DEFAULT_FULL_REPORT_URL:"https://safeweb.norton.com/report/show",HTTP_PROTOCOL:"http",HTTPS_PROTOCOL:"https",HTTPS_GET_METHOD:"GET",HTTPS_POST_METHOD:"POST",PII_SUBMISSION_TIMEOUT:2e3,SCAM_INSIGHT_BLOCK_PAGE_PATH:"content/ui/scam-insight-block-page.html",BLOCK_PAGE_PATH:"content/ui/blockedPage.html",SYMC_USER_AGENT:"X-Symc-User-Agent",X_NLOK_COUNTRY:"X-NLOK-COUNTRY",ACCEPT_HEADER:"Accept",APPLICATION_JSON:"application/json",WRS_HEADER_VALUES:{XBP_SAFEWEB:"xBP/SafeWeb",XBP_SAFEWEB_YAHOO:"xBP/SafeWeb_Yahoo",XBP_SAFEWEB_YAHOO_ADVT:"xBP/SafeWeb_Yahoo_Advt"},JAPAN_LOCALE:"ja",ROOT_NODE:{TAG_NAME:"symantec",VERSION_ATTR:"@v",CACHE_POSITIVE_ATTR:"@cacheP",CACHE_NEGATIVE_ATTR:"@cacheN"},PII_FLAGS:{EXIT_SITE:0,CONTINUE_TO_SITE:1,SUPPRESSED_DUE_TO_SILENTMODE:2,SUPPRESSED_DUE_TO_HTTPS:4},PII_SUBMISSION_STATUS:{SUCCESS:"Success",FAILURE:"Fail"},SITE_NODE:{TAG_NAME:"site",CANONICAL_SITE_ID_ATTR:"@id",COMBINED_RATING_ATTR:"@r",SECURITY_RATING_ATTR:"@sr",BUSINESS_RATING_ATTR:"@br",CATEGORY_ATTR:"@category",CACHE_ATTR:"@cache",PII_ENABLE_ATTR:"@piien",PII_POLICY_HTTPS:"@piipolhttps",PII_POLICY_ID:"@piipolid",PII_POLICY_FIELD_TYPE:"@piipolft"},WRS_RATINGS:{UNKNOWN_SITE:"u",BAD_SITE:"b",WARNING_SITE:"w",GOOD_SITE:"g",NORTON_SECURE_SITE:"r",PII_NOT_ENABLED:"n",PII_ENABLED:"y",PII_SILENCE:"s",REGIONAL_BLOCK:"grbl"},ANNOYANCE_FACTORS_KEYS:{PUAPP:!0,HRDUN:!0,JOKE:!0,MLAPP:!0,TRCKW:!0,TPSQT:!0,PPCNA:!0,HACK:!0,SPAM:!0,SWBPL:!0},PII_FACTORS_KEYS:{PIIAGE:"@age",PIIPOP:"@pop"},PII_POLICY_HTTPS_KEYS:{DONTCARE:"dc",HTTPS:"h"},IDENTITY_THREATS_KEYS:{MLWR:!0,MBCHG:!0,RMTA:!0,PHISH:!0,BDOOR:!0,ISTLR:!0,DIAL:!0,DLDR:!0,SPWR:!0},SHOPPING_RISKS_KEYS:{CTFGS:!0,RCGS:!0,REPLC:!0},COMPUTER_THREATS_KEYS:{COHD:!0,ADWR:!0,VIRUS:!0,WORM:!0,SRISK:!0,BREXP:!0,MLWR:!0,MBCHG:!0,HEUR:!0,ELTMS:!0,TRJN:!0},SITE_FACT_NODE:{TAG_NAME:"d",REPORTED_BY_KEY:"reported_by",SRC_KEY:"src",ID_KEY:"id"},SITE_FACT_IDS:{PRIVACY_POLICY_APPROVED:"privacy policy approved",NETWORK_SCANNING_SERVICE:"network scanning service",SSL_CA_NAME:"ssl CA name",AUTHORIZED_RESELLER:"Authorized Reseller",CERTIFIED_BUSINESS:"certified business",VERISIGN_TRUSTED:"VRTRU",VERISIGN_SSL:"VRSSL"},SITE_FACT_SOURCES:{SRC_BUYSAFE:"BUYSAFE",SRC_VERISIGN:"Verisign",SRC_MARK_MONITOR:"MARKMONITOR"},ATTRIBUTE_COUNT:"@cnt",CACHE_LIMIT:1e3,RATING_TYPE:{WCID_HEURISTICS:1,WCID_CHECK_URL:2,SAFEWEB:3,SCAM_INSIGHT:4},MESSAGES:{WAX_FIELDS_FOUND:"45E6BAD1-9F79-4E16-BA3A-1F77AA21EAC9",PROCESS_PAGE_FOR_SCAM_FIELDS:"FEDA41BC-73DC-4F99-A2CF-B5589CF2D0F8",TOP_FRAME_UNLOADED:"E5C199FF-A74B-414F-803C-4C7030C0E573",CAN_ANALYZE_FOR_SCAM:"6E6CDFB7-4CF6-4C73-B998-6CA3432DDC07"},IS_SCAM_INSIGHT_ENABLED:!0,performanceReporter:{COMPONENT:{SCAM_INSIGHT:"scam_insight"},TYPE:{INIT:"init",PII_PROTO_SUBMISSION:"_piiProtoSubmission",CALCULATE_SCAM_RATING:"_calculateScamInsightRating",HANDLE_PII_RATING:"_handlePIIEnabledRating",SET_WRS_RESPONSE:"setWrsResponse",HANDLE_MESSAGE:"_handleMessage",HANDLE_MESSAGE_CALLBACK:"_handleScamPageFoundCallback",HANDLE_CACHE_RESPONSE:"_handleCacheResponse",SEND_PII_SUBMISSION:"sendPIISubmission",COLLECT_PII_FIELDS:"_collectPIIFields",TOP_FRAME_UNLOADED:"topFrameUnloaded",ADD_MUTATION_OBSERVER:"_addBodyMutationObserver",FIELD_FOUND_CALLBACK:"handleFieldsFoundCallback",WAX_CONTROLLER_INITIALIZE:"scamInsightWaxControllerInitialize",CAN_ANALYZE_HANDLER_RESPONSE:"canAnalyzeForScamHandlerResponse",RUN_WAX_ANALYSIS:"_runWaxAnalysis"}},SCAM_INSIGHT_RESULT:{UNTESTED:0,SUSPICIOUS_PAGE:1,SUSPICIOUS_NO_BLOCK_PAGE:2,NOT_SUSPICIOUS_PAGE:3},SCAM_INSIGHT_RATING_KEY:"scamRating",SCAM_ANALYSIS_STATE:{PENDING:0,ANALYZE:1},YAHOO_DOMAIN:"yahoo.com",HSPART_KEY:"hspart",HSPART_VALUE:["symantec","norton"],SAFEWEB_STORAGE_CONTAINER:"safeweb_storage_container",NORMALIZED_URL_RATING_MAP:"normalized_url_rating_map",CACHED_URLS_COUNT:"cached_urls_count",VIEW_ANYWAY_CACHE:"view_anyway_cache",URLS_TO_BE_REMOVED:"urls_to_be_removed",SW_REMOVE_CACHE_ITEM_ALARM:"sw_remove_cache_item_alarm",SW_REMOVE_VIEW_ANYWAY_ALARM:"sw_remove_view_anyway_alarm",ALARM_URL_SEPARATOR:"alarm_",MINIMUM_ALARM_INTERVAL:"60000",MS_TO_MIN_CONVERSION_VALUE:6e4})}(executionContext),function(e){const{settings:t,utils:{isntNil:i}}=SymBfw,o=SafeWeb["constants"];e.SafeWeb.storageContainer=new class{constructor(){this._container=null}initialize(){return new Promise((n,r)=>{if(i(this._container))return n(!0);t.loadSettingsContainer(o.SAFEWEB_STORAGE_CONTAINER,!0,(e,t,i)=>{!1!==e&&t?(this._container=t,n(!0)):r(i)})})}_isStorageInitialized(){return!!this._container}getValue(e){if(this._isStorageInitialized())return this._container.getObject(e)}setValue(e,t){this._isStorageInitialized()&&this._container.setObject(e,t)}},SafeWeb.storageContainer.initialize()}(executionContext),function(e){const{alarmHelper:i,logger:n,utils:{isNumber:r}}=SymBfw,o=SafeWeb["constants"];e.SafeWeb.utils=new class{async registerTimeoutOperation(e,t){!r(t)||t<o.MINIMUM_ALARM_INTERVAL?n.log("Invalid delay interval"):(t/=o.MS_TO_MIN_CONVERSION_VALUE,await i.setAlarm(e,{delayInMinutes:t}))}}}(executionContext),function(e){const{utils:{isString:n,isNil:r,isEmptyObject:o},logger:a}=SymBfw,{constants:s,storageContainer:S}=SafeWeb;e.SafeWeb.cacheUtils=new class{constructor(){this._normalizedUrlsRatingMap=null}setRatingInStorage(t,i){if(n(t))if(o(i))a.log("rating object is not valid");else{let e=S.getValue(s.NORMALIZED_URL_RATING_MAP);(e=r(e)?{}:e)[t]=i,S.setValue(s.NORMALIZED_URL_RATING_MAP,e),this._normalizedUrlsRatingMap=e}else a.log("url is not string")}getRatingFromStorage(e){var t;{if(n(e))return t=this._normalizedUrlsRatingMap||S.getValue(s.NORMALIZED_URL_RATING_MAP),r(t)?null:t[e];a.log("url is not string")}}removeRatingFromStorage(e){if(n(e)){const t=S.getValue(s.NORMALIZED_URL_RATING_MAP);r(t)||r(t[e])||(delete t[e],S.setValue(s.NORMALIZED_URL_RATING_MAP,t))}else a.log("Url should be a string")}getAllRatingsFromStorage(){return S.getValue(s.NORMALIZED_URL_RATING_MAP)}getCachedUrlsCount(){var e=this._normalizedUrlsRatingMap||this.getAllRatingsFromStorage();return r(e)?0:Object.keys(e).length}clearCache(){S.setValue(s.NORMALIZED_URL_RATING_MAP,{})}}}(executionContext),function(e){"use strict";e.SafeWeb.telemetryWrapper=function(o){let n={};o.utils.isntNil,o.utils.isNil;const a=o.utils.isString,s=o.telemetryConstants;return n.TELEMETRY_CATEGORY={SCAM_INSIGHT:"Scam_Insight"},n.actionType={PROTO:{PII_SUBMISSION:"PII_Submission"}},n.sendPIISubmissionStatusEvent=function(e){if(!a(e))return null;var t=n.TELEMETRY_CATEGORY.SCAM_INSIGHT,i=n.actionType.PROTO.PII_SUBMISSION;n.send(t,i,e)},n.send=function(e,t,i){if(!a(e)||!a(t)||!a(i))return null;let n={},r=(n[s.parameters.HIT_TYPE]=s.HIT_TYPE.EVENT,n[s.parameters.CATEGORY]=e,n[s.parameters.ACTION]=t,n[s.parameters.LABEL]=i,o.telemetry||o.telemetryProxy);r.send(n)},n}(e.SymBfw,e.SafeWeb)}(executionContext),function(e){"use strict";e.SafeWeb.Rating=function(a){const s=a.utils.isNil,t=(a.utils.isFunction,a.utils.isArray),e=SafeWeb.constants;var i=a.utils;const n=a.localizer,r=a.utils.isInteger,o=a.utils.isString,S=SafeWeb.constants;function I(e){if(s(e))throw new Error("Input dictionary cannot be null");var t,i=I.ratingSchema;for(t in i){var n=i[t],r=e[t];if(s(r)){if(n.isRequired)throw new Error("Cannot find value for key "+t+" in the input dictionary.");var o=n.defaultValue;if(s(o))throw new Error("Default value has not been supplied in the Schema.");this[t]=n.defaultValue}else{if(!1===(0,n.typeChecker)(r))throw new Error("Input value for key "+t+" does not match schema.");this[t]=r}}this.id=a.utils.createNewGuid()}return I.ratingSchema={computerThreats:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},annoyanceFactors:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},identityThreats:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},shoppingRisks:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},phishingThreats:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},siteRating:{isRequired:!0,typeChecker:i.isInteger},fullURL:{isRequired:!0,typeChecker:i.isString},normalizedURL:{isRequired:!0,typeChecker:i.isString},cacheTime:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},category:{isRequired:!1,typeChecker:i.isString,defaultValue:"none"},piiAttributes:{isRequired:!1,typeChecker:I._checkPIISchema=function(e){return!!o(e.piiEnable)&&(S.WRS_RATINGS.PII_ENABLED!==e.piiEnable&&S.WRS_RATINGS.PII_SILENCE!==e.piiEnable||!!o(e.piiPolHttps)&&(!!o(e.piiPolID)&&(!!t(e.piiFieldType)&&(!!r(e.age)&&!!r(e.pop)))))},defaultValue:{piiEnable:S.WRS_RATINGS.PII_NOT_ENABLED}},scamRating:{isRequired:!1,typeChecker:i.isInteger,defaultValue:e.SCAM_INSIGHT_RESULT.UNTESTED}},I.prototype.getComputerThreats=function(){return this.computerThreats},I.prototype.getAnnoyanceFactors=function(){return this.annoyanceFactors},I.prototype.getIdentityThreats=function(){return this.identityThreats},I.prototype.getShoppingRisks=function(){return this.shoppingRisks},I.prototype.getPhishingThreats=function(){return this.phishingThreats},I.prototype.getFullReportURL=function(){return e.DEFAULT_FULL_REPORT_URL+"?url="+this.getFullURL()+"&ulang="+n.getLocale()},I.prototype.getSiteRating=function(){return this.siteRating},I.prototype.getFullURL=function(){return this.fullURL},I.prototype.getNormalizedURL=function(){return this.normalizedURL},I.prototype.getID=function(){return this.id},I.prototype.getCacheTime=function(){return this.cacheTime},I.prototype.getCategory=function(){return this.category},I.prototype.getPIIEnValue=function(){return this.piiAttributes.piiEnable},I.prototype.getPIIPolID=function(){return s(this.piiAttributes.piiPolID)?null:this.piiAttributes.piiPolID},I.prototype.getPIIHTTPS=function(){return s(this.piiAttributes.piiPolHttps)?null:this.piiAttributes.piiPolHttps},I.prototype.getPIIFieldType=function(){return s(this.piiAttributes.piiFieldType)?[]:this.piiAttributes.piiFieldType},I.prototype.getPIIAge=function(){return s(this.piiAttributes.age)?0:this.piiAttributes.age},I.prototype.getPIIPop=function(){return s(this.piiAttributes.pop)?0:this.piiAttributes.pop},I.prototype.getScamRating=function(){return this.scamRating},I.prototype.serialize=function(){return JSON.stringify(this)},I.SITE_RATING={SW_INVALID_STATE:0,SW_TRUSTED_STATE:1,SW_NEUTRAL_STATE:2,SW_KNOWN_PHISHING_STATE:3,SW_SUSPECTED_PHISHING_STATE:4,SW_KNOWN_MALICIOUS_STATE:5,SW_CAUTION_MALICIOUS_STATE:6,SW_NORTON_CERTIFIED:7,SW_TRUSTED_TRANSACTION_STATE:8,SW_UNTRUSTED_TRANSACTION_STATE:9,SW_PAGE_BAD_UNTRUSTED_TRANSACTION_STATE:10,SW_DISABLED_STATE:11,SW_UNLICENSED_STATE:12,SW_ERROR_STATE:13,SW_PENDING_STATE:14,SW_MAX_STATE:15,SW_REGIONAL_BLOCK:17},I}(e.SymBfw)}(executionContext),function(e){"use strict";e.SafeWeb.WrsParser=function(e){const l=e.utils.isNil,S=e.utils.isntNil,u=(e.utils.isFunction,e.utils.isArray),c=e.utils.isEmptyObject,R=SafeWeb.constants,A=e.logger,N=SafeWeb.Rating;function t(){this._rootDict={cacheP:600,cacheN:600}}return t.prototype.parseWRSResponse=function(e,t){if(l(e))return null;if(l(t))throw new Error("URL Array cannot be null.");e=this.parseRootNode(e);return l(e)?null:this.parseSiteInformation(e,t)},t.prototype.isSiteRegionalBlock=function(e,t){return e!==N.SITE_RATING.SW_PAGE_BAD_UNTRUSTED_TRANSACTION_STATE&&e!==N.SITE_RATING.SW_KNOWN_MALICIOUS_STATE&&t===R.WRS_RATINGS.REGIONAL_BLOCK},t.prototype.parseSiteInformation=function(e,t){var i=e[R.SITE_NODE.TAG_NAME],n=(i=u(i)?i:[i]).length;if(0===n)return null;if(t.length!==n)return A.error("Lengths of input URL Array("+t.length+") and Shasta results("+n+") do not match."),null;for(var r=[],o=0;o<n;o++){var a=i[o],s={},S=!1;let e={};s.fullURL=t[o];for(const _ in a)switch(_){case R.SITE_NODE.CANONICAL_SITE_ID_ATTR:s.normalizedURL=a[_];break;case R.SITE_NODE.COMBINED_RATING_ATTR:s.combinedRating=a[_];break;case R.SITE_NODE.SECURITY_RATING_ATTR:s.securityRating=a[_],S=!0;break;case R.SITE_NODE.BUSINESS_RATING_ATTR:s.shoppingRating=a[_];break;case R.SITE_NODE.CACHE_ATTR:s.cacheTime=Number(a[_]);break;case R.SITE_NODE.CATEGORY_ATTR:s.category=a[_];break;case R.SITE_NODE.PII_ENABLE_ATTR:e.piiEnable=a[_];break;case R.SITE_NODE.PII_POLICY_HTTPS:e.piiPolHttps=a[_];break;case R.SITE_NODE.PII_POLICY_ID:e.piiPolID=a[_];break;case R.SITE_NODE.PII_POLICY_FIELD_TYPE:const T=a[_];if("*"===T)e.piiFieldType=["*"];else{const E=T.split(",").map(Number);e.piiFieldType=E.filter(e=>!isNaN(e))}}s.piiAttributes=e,c(s.piiAttributes)&&(s.piiAttributes.piiEnable=R.WRS_RATINGS.PII_NOT_ENABLED),l(s.normalizedURL)&&(s.normalizedURL=""),l(s.combinedRating)&&(s.combinedRating=R.WRS_RATINGS.UNKNOWN_SITE),l(s.securityRating)&&(s.securityRating=R.WRS_RATINGS.UNKNOWN_SITE),l(s.shoppingRating)&&(s.shoppingRating=R.WRS_RATINGS.UNKNOWN_SITE),l(s.cacheTime)&&(s.cacheTime=!1===S?this._rootDict.cacheN:this._rootDict.cacheP),s.siteRating=this.getSiteRating(s.securityRating,s.shoppingRating);this.isSiteRegionalBlock(s.siteRating,s.category)&&(s.siteRating=N.SITE_RATING.SW_REGIONAL_BLOCK),this.parseSiteAttributes(a,s);var I=new N(s);r.push(I)}return r},t.prototype.parseSiteAttributes=function(e,t){var i,n=0,r=0,o=0,a=0;for(const s in e)S(R.ANNOYANCE_FACTORS_KEYS[s])&&(r+=Number(e[s][R.ATTRIBUTE_COUNT])),S(R.IDENTITY_THREATS_KEYS[s])&&(o+=Number(e[s][R.ATTRIBUTE_COUNT])),S(R.SHOPPING_RISKS_KEYS[s])&&(a+=Number(e[s][R.ATTRIBUTE_COUNT])),S(R.COMPUTER_THREATS_KEYS[s])&&(n+=Number(e[s][R.ATTRIBUTE_COUNT])),S(R.PII_FACTORS_KEYS[s])&&(l(t.piiAttributes)&&(t.piiAttributes={}),i=R.PII_FACTORS_KEYS[s].substring(1),t.piiAttributes[i]=Number(e[s][R.PII_FACTORS_KEYS[s]]));t.computerThreats=n,t.annoyanceFactors=r,t.identityThreats=o,t.shoppingRisks=a},t.prototype.getSiteRating=function(e,t){if(e===R.WRS_RATINGS.NORTON_SECURE_SITE)return N.SITE_RATING.SW_NORTON_CERTIFIED;if(e===R.WRS_RATINGS.GOOD_SITE){if(t===R.WRS_RATINGS.GOOD_SITE)return N.SITE_RATING.SW_TRUSTED_TRANSACTION_STATE;if(t===R.WRS_RATINGS.UNKNOWN_SITE)return N.SITE_RATING.SW_TRUSTED_STATE}return e===R.WRS_RATINGS.BAD_SITE?t===R.WRS_RATINGS.BAD_SITE?N.SITE_RATING.SW_PAGE_BAD_UNTRUSTED_TRANSACTION_STATE:N.SITE_RATING.SW_KNOWN_MALICIOUS_STATE:t===R.WRS_RATINGS.WARNING_SITE||t===R.WRS_RATINGS.BAD_SITE?N.SITE_RATING.SW_UNTRUSTED_TRANSACTION_STATE:e===R.WRS_RATINGS.WARNING_SITE?N.SITE_RATING.SW_CAUTION_MALICIOUS_STATE:N.SITE_RATING.SW_NEUTRAL_STATE},t.prototype.parseRootNode=function(e){var t=e[R.ROOT_NODE.TAG_NAME];if(!t)return null;for(const i in t)switch(i){case R.ROOT_NODE.VERSION_ATTR:this._rootDict[R.ROOT_NODE.VERSION_ATTR]=t[i];break;case R.ROOT_NODE.CACHE_POSITIVE_ATTR:this._rootDict[R.ROOT_NODE.CACHE_POSITIVE_ATTR]=Number(t[i]);break;case R.ROOT_NODE.CACHE_NEGATIVE_ATTR:this._rootDict[R.ROOT_NODE.CACHE_NEGATIVE_ATTR]=Number(t[i])}return t},t}(e.SymBfw)}(executionContext),function(e){"use strict";e.SafeWeb.connection=function(s){var S={timeoutFunction:null},I=s.utils.isNil,_=s.utils.isntNil,T=s.utils.isFunction,a=s.utils.isArray,E=SafeWeb.constants,l=SafeWeb.WrsParser;const u=s.localizer,c=s.logger;return S.getResultForURL=function(o,a){if(I(o))throw new Error("URL cannot be null");if(!1===T(a))throw new Error("Shasta Connection callback cannot be null");var e=encodeURIComponent(SafeWeb.cache.safeURL(o)),e=E.SHASTA_URL+"/"+E.SHASTA_LOOKUP_PATH+"?url="+e,t=S.constructHeader({senderURL:o,methodType:E.HTTPS_GET_METHOD});S.shastaConnection(e,E.HTTPS_GET_METHOD,function(e){const t=e.status;var i=e.responseData;if(200===t){const n=new l,r=n.parseWRSResponse(i,[o]);return SafeWeb.cache.addRatingsToCache(r),void setTimeout(function(){a(t,r)},1)}setTimeout(function(){a(t,e)},1)},t)},S.constructHeader=function(t){var e=u.getNavigatorLanguage().split("-");let i=e[1],n=(I(i)&&e[0]==E.JAPAN_LOCALE&&(i="JP"),I(i)&&(i="US"),{});if(n[E.ACCEPT_HEADER]=E.APPLICATION_JSON,_(t))switch(t.methodType){case E.HTTPS_GET_METHOD:n[E.SYMC_USER_AGENT]=E.WRS_HEADER_VALUES.XBP_SAFEWEB,n[E.X_NLOK_COUNTRY]=i;break;case E.HTTPS_POST_METHOD:if(_(t.senderURL)){let e=new URI(t.senderURL);var r=e.domain(),o=e.query(!0);_(o)&&r===E.YAHOO_DOMAIN&&E.HSPART_VALUE.includes(o[E.HSPART_KEY])&&(I(t.bAdvtFlag)?n[E.SYMC_USER_AGENT]=E.WRS_HEADER_VALUES.XBP_SAFEWEB_YAHOO:n[E.SYMC_USER_AGENT]=E.WRS_HEADER_VALUES.XBP_SAFEWEB_YAHOO_ADVT)}n[E.X_NLOK_COUNTRY]=i;break;default:n[E.SYMC_USER_AGENT]=E.WRS_HEADER_VALUES.XBP_SAFEWEB,n[E.X_NLOK_COUNTRY]=i}return new Headers(n)},S.getResultsForURLs=function(r,o,e){if(!1===a(r))throw new Error("URL Array cannot be null");if(0===r.length)throw new Error("URL Array length cannot be null");if(!1===T(o))throw new Error("Shasta Connection callback cannot be null");if(I(e))throw new Error("Payload cannot null");var t,i=E.SHASTA_URL+"/"+E.SHASTA_LOOKUP_PATH,n="";for(t in r)n+=r[t]+"\r\n";e.methodType=E.HTTPS_POST_METHOD;e=S.constructHeader(e);S.shastaConnection(i,E.HTTPS_POST_METHOD,function(e){var t,i=e.status,n=e.responseData;if(200===i)return t=(new l).parseWRSResponse(n,r),SafeWeb.cache.addRatingsToCache(t),void setTimeout(function(){o(i,t)},1);setTimeout(function(){o(i,e)},1)},e,n)},S.shastaConnection=async function(t,i,n,r,o){if(I(t))throw new Error("API URL cannot be null");if(I(i))throw new Error("HTTP Method cannot be null");if(!1===T(n))throw new Error("Shasta Callback cannot be null");try{const a=await s.utils.safeFetch(t,{credentials:"omit",method:i,headers:r,body:o});var e;!0===a.ok?(e=await a.json(),n({status:a.status,responseData:e})):(c.debug("safeFetch() FAILED - url : "+a.url+" - HTTP code : "+a.status),n({status:a.status,responseData:null}))}catch(e){if(_(S.timeoutFunction))return S.timeoutFunction=null,c.error("Exception received from safeFetch \n"+e),void n({status:null,responseData:null});S.timeoutFunction=setTimeout(()=>{S.shastaConnection(t,i,n,r,o)},5e3)}},S}(e.SymBfw)}(executionContext),function(e){"use strict";(e.SafeWeb.ScamInsightPII=e.SafeWeb.ScamInsightPII||{}).proto=(e.SymBfw,dcodeIO.ProtoBuf.newBuilder({}).import({package:"PIIFeatureTelem",syntax:"proto2",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"ScamInsight_PII_Submission_List",syntax:"proto2",fields:[{rule:"optional",type:"uint32",name:"Version",id:1,options:{default:1}},{rule:"optional",type:"bytes",name:"Enterprise_GUID",id:2},{rule:"optional",type:"bytes",name:"Machine_GUID",id:3},{rule:"optional",type:"bytes",name:"Machine_CAT",id:4},{rule:"optional",type:"string",name:"ProductName",id:5,options:{default:""}},{rule:"optional",type:"string",name:"ProductVersion",id:6,options:{default:""}},{rule:"repeated",type:"Submission_Type",name:"Submission",id:7}],messages:[{name:"Submission_Type",syntax:"proto2",fields:[{rule:"optional",type:"int64",name:"UTCTime",id:1},{rule:"optional",type:"sint32",name:"LocalTZUTCOffset",id:2},{rule:"optional",type:"string",name:"Site_URL",id:3},{rule:"optional",type:"string",name:"Referrer_URL",id:4},{rule:"optional",type:"string",name:"FormAction_URL",id:5},{rule:"optional",type:"string",name:"PII_PolicyID",id:6},{rule:"repeated",type:"uint32",name:"Form_Fields",id:7},{rule:"optional",type:"uint32",name:"PII_Flags",id:8}]}]}],enums:[{name:"ScamInsight_PII_FlagValues",syntax:"proto2",values:[{name:"SCAMINSIGHT_PII_CONTINUED_TO_PAGE",id:1},{name:"SCAMINSIGHT_PII_SUPPRESSEDDUETOSILENTMODE",id:2},{name:"SCAMINSIGHT_PII_SUPPRESSEDDUETOHTTPS",id:4}]}],isNamespace:!0}).build())}(executionContext),function(e){"use strict";e.SafeWeb.piiprotoutils=function(i){let n={},r=SafeWeb.ScamInsightPII.proto.PIIFeatureTelem.ScamInsight_PII_Submission_List,o=r.Submission_Type;const a=i.utils.isNil,e=(i.utils.isFunction,i.utils.isArray),s=i.utils.isEmptyObject,t=i.utils.isString,S=(i.utils.isSuccessCode,i.utils.urlWithoutQueryParameters);let I="1.0.0";const _={POST_METHOD:"POST",CONTENT_TYPE:"Content-Type",API_URL:"https://shasta-clt.norton.com/incident-pii/1",REQ_TIMEOUT:1e3,PROTOBUF:"application/x-protobuf"};class T{constructor(){this.piiSubmissionItem={UNIX_TIME:null,OFFSET_TIME:null,SITE_URL:null,REFERRER_URL:null,FORM_ACTION_URL:null,PII_POLICYID:null,FORM_FIELDS:null,PII_FLAGS:null}}setSubmissionTime(){let e=new Date;this.piiSubmissionItem.UNIX_TIME=e.getTime(),this.piiSubmissionItem.OFFSET_TIME=e.getTimezoneOffset()}setSiteUrl(e){e=S(e),e=encodeURIComponent(e);this.piiSubmissionItem.SITE_URL=e}isValidPIISubmissionData(){return!a(this.piiSubmissionItem.UNIX_TIME)&&!a(this.piiSubmissionItem.OFFSET_TIME)&&(!(s(this.piiSubmissionItem.SITE_URL)||!t(this.piiSubmissionItem.SITE_URL))&&(!(s(this.piiSubmissionItem.PII_POLICYID)||!t(this.piiSubmissionItem.PII_POLICYID))&&(!!e(this.piiSubmissionItem.FORM_FIELDS)&&!a(this.piiSubmissionItem.PII_FLAGS))))}}return n._fillPIIItem=function(e,t){s(e.piiSubmissionItem.REFERRER_URL)||t.setReferrerURL(encodeURIComponent(e.piiSubmissionItem.REFERRER_URL)),s(e.piiSubmissionItem.FORM_ACTION_URL)||t.setFormActionURL(encodeURIComponent(e.piiSubmissionItem.FORM_ACTION_URL));var i=dcodeIO.Long.fromNumber(e.piiSubmissionItem.UNIX_TIME);t.setUTCTime(i),t.setLocalTZUTCOffset(e.piiSubmissionItem.OFFSET_TIME),t.setSiteURL(e.piiSubmissionItem.SITE_URL),t.setPIIPolicyID(e.piiSubmissionItem.PII_POLICYID),t.setFormFields(e.piiSubmissionItem.FORM_FIELDS),t.setPIIFlags(e.piiSubmissionItem.PII_FLAGS)},n.setPIIProductVersion=function(e){if(!t(e))throw new Error("Invalid string");I=e},n._createPIIList=function(e){let t=new r;var i=new o;return t.setVersion(1),t.setProductName("NSSS"),t.setProductVersion(I),n._fillPIIItem(e,i),t.setSubmission(i),t},n.submitShastaPII=async function(e){if(!(e instanceof T))throw new Error("Invalid PII Object");if(!e.isValidPIISubmissionData())throw new Error("Invalid PII Submission Data");let t=n._createPIIList(e);if(a(t))throw new Error("PII Creation Failed");e=t.toArrayBuffer();if(a(e))throw new Error("Invalid Serialized Message");return n._sendPIIDataToShasta(e)},n._sendPIIDataToShasta=async function(e){var t={"Content-Type":_.PROTOBUF},t={method:_.POST_METHOD,headers:t,body:e};try{if((await fetch(_.API_URL,t)).status!==i.constants.httpStatusCodes.OK)throw new Error("PII Submission Failed");return}catch(e){throw new Error("PII Submission Failed")}},n.getPIISUbmissionObj=function(){return new T},n}(e.SymBfw)}(executionContext),function(O){"use strict";O.SafeWeb.cache=function(e){const{logger:s,utils:{isNil:I,isntNil:R,isEmptyObject:A,urlWithoutQueryParameters:N}}=e,{cacheUtils:p,constants:S,connection:_,storageContainer:t,utils:T}=SafeWeb,P={safeURL:function(e){e=new URI(e);return e.protocol()+"://"+e.hostname()+e.pathname()},isLocaleJapan:function(){return e.localizer.getNavigatorLanguage().split("-")[0]===S.JAPAN_LOCALE},addRatingsToCache:function(e){if(I(e)||0===e.length)throw new Error("Ratings array cannot be null or empty");var t,i=P.isLocaleJapan();for(t in e){if(p.getCachedUrlsCount()>=S.CACHE_LIMIT)return;var n,r,o,a=e[t];I(a)||0!==(n=a.getCacheTime())&&(r=i?N(a.getFullURL()):a.getNormalizedURL(),o=null,I(r)||0===r.length?(o=P.safeURL(a.getFullURL()),s.error("Normalized URL cannot not be null or empty:"+o)):(p.setRatingInStorage(r,a),T.registerTimeoutOperation(S.SW_REMOVE_CACHE_ITEM_ALARM+"_"+r,1e3*n)))}},removeRatingFromCache:async function(e){if(I(e))throw new Error("Normalized URL cannot be null");await t.initialize(),p.removeRatingFromStorage(e)},getRatingForURL:function(e,n){var t=P.ratingForCachedURL(e);R(t)?setTimeout(function(){n(t)},1):_.getResultForURL(e,function(e,t){var i=200===e?t[0]:null;setTimeout(function(){n(i)},1)})},ratingForCachedURL:function(e){if(A(p.getAllRatingsFromStorage()))return null;var t=new URI(e),i=null,n=P.isLocaleJapan();do{if(n){i=p.getRatingFromStorage(N(e));break}for(var r=t.hostname(),o=t.domain(),a=null,s=t.segment(),S=t.pathname(),I=s.length,_=0;a=""+r+S,i=p.getRatingFromStorage(N(e)),!R(i)&&(S=S.slice(0,S.lastIndexOf("/")),++_<I););if(R(i))break;if(!0===t.is("IP")&&(i=p.getRatingFromStorage(r),R(i)))break;var T=t.subdomain();if(R(T)&&0<T.length){for(var E=T.split(".").length,l=0;a=T+"."+o,i=p.getRatingFromStorage(a),!R(i)&&(T=T.slice(T.indexOf(".")+1,T.length),++l<E););if(R(i))break}a=o,i=p.getRatingFromStorage(a);break}while(0);var u,c=null;return R(i)&&((u=JSON.parse(JSON.stringify(i))).fullURL=e,c=new O.SafeWeb.Rating(u)),c},getRatingsForURLs:function(e,a,t){var i,s=[],S=(s.length=e.length,{}),n=[];for(i in e){var r,o=e[i];I(o)?s[i]=null:(r=P.ratingForCachedURL(o),R(r)?s[i]=r:(S[n.length]=i,n.push(o)))}0===n.length?setTimeout(function(){a(s)},1):_.getResultsForURLs(n,function(e,t){if(200===e){var i,n=t;for(i in n){var r=n[i],o=S[i];s[o]=r}}setTimeout(function(){a(s)},1)},t)},updateCacheRatingsForUrl:function(e){var t;I(e)||(t=e.getNormalizedURL(),I(t)||0===t.length?s.log("Normalized url for this newRating is null, dont proceed further to alter in this case"):R(p.getRatingFromStorage(t))&&p.setRatingInStorage(t,e))},handleStartup:async function(){await t.initialize(),p.clearCache()}};return P}(O.SymBfw),SymBfw.extensionAdapter.addStartupListener(SafeWeb.cache.handleStartup)}(executionContext),function(e){"use strict";e.SafeWeb.scamInsightUtility=function(i,n){const{urlWithoutQueryParameters:r,isEmptyObject:o,isNil:a}=i["utils"],{storageContainer:s,constants:S}=n;let e={addToViewAnywayCache:function(t){if(!o(t)){t=r(t);let e=s.getValue(S.VIEW_ANYWAY_CACHE);(e=a(e)?new Set:e).has(t)||(e.add(t),s.setValue(S.VIEW_ANYWAY_CACHE,e),n.utils.registerTimeoutOperation(S.SW_REMOVE_VIEW_ANYWAY_ALARM+"_"+t,18e5))}},removeFromViewCache:async function(e){i.logger.debug("Removing from view cache : "+e),await s.initialize();let t=s.getValue(S.VIEW_ANYWAY_CACHE);t.delete(e),s.setValue(S.VIEW_ANYWAY_CACHE,t)},isURLInViewAnywayCache:function(e){if(o(e))return!1;e=r(e);const t=s.getValue(S.VIEW_ANYWAY_CACHE);return!a(t)&&t.has(e)}};return e}(e.SymBfw,e.SafeWeb)}(executionContext),function(e){"use strict";e.SafeWeb.manager=function(e){const{cache:o,constants:i,scamInsightUtility:n}=SafeWeb,{isNil:a,isFunction:s}=e["utils"];var S={getRatingForURL:function(e,t){if(a(e))throw new Error("URL array cannot be null or empty.");if(!1===s(t))throw new Error("Callback function cannot be null.");!1===S.validateURL(e)?setTimeout(function(){t(null)},1):o.getRatingForURL(e,t)},getRatingsForURLs:function(e,t,i){if(a(e)||0===e.length)throw new Error("URL array cannot be null or empty.");if(!1===s(t))throw new Error("Callback function cannot be null.");for(var n in e){var r=e[n];!1===S.validateURL(r)&&(e[n]=null)}o.getRatingsForURLs(e,t,i)},validateURL:function(e){if(a(e))return!1;var e=new URI(e),t=e.protocol(),e=e.hostname();return 0!==t.length&&0!==e.length&&("http"===t||"https"===t)},handleSchedulerEvent:function(e){var t;if(e.name.startsWith(i.SW_REMOVE_CACHE_ITEM_ALARM))return t=S._getUrlFromAlarmName(e.name),void o.removeRatingFromCache(t);e.name.startsWith(i.SW_REMOVE_VIEW_ANYWAY_ALARM)&&(t=S._getUrlFromAlarmName(e.name),n.removeFromViewCache(t))},_getUrlFromAlarmName:function(e){return e.split(i.ALARM_URL_SEPARATOR)[1]}};return S}(e.SymBfw),SymBfw.alarmHelper.registerAlarmListener(SafeWeb.manager.handleSchedulerEvent)}(executionContext),function(e){"use strict";e.SafeWeb.scamInsightMgr=function(e,a){const S=e.extensionAdapter,s=e.utils.isEmptyObject,I=e.utils.isNil,o=e.utils.isntNil,_=e.utils.isArray,T=e.utils.isInteger,t=e.utils.isString,E=a.constants,l=e.telemetrySettings,u=a.piiprotoutils,c=e.utils.urlProtocol,R=e.logger,i=(e.utils.isBoolean,e.utils.isFunction),A=e.performanceReporterFactory,n=a.piiprotoutils,N={WRS_SCAM_RESPONSE:"wrsScamResponse",WAX_FIELDS_INFO:"waxFieldsInfo",MATCHED_FIELDS:"matchedFields",PII_SUBMISSION_TIMER:"piiSubmissionTimer",PII_FLAG:"piiFlag",PII_SUBMITTED:"piiSubmitted",SCAM_INSIGHT_BLOCK_PAGE_HANDLED:"scamInsightBlockPageHandled",TRIGGER_WAX_ANALYSIS:"triggerWaxAnalysis"};let p={initialize:function(){var e;E.IS_SCAM_INSIGHT_ENABLED&&(e=E.performanceReporter.TYPE.INIT+":"+Date.now(),A.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,e),p._processedTabFields=new Map,p._PIISubmissionInfo=new Map,p._scamPageFoundCallback=null,S.addMessageListener(p._handleMessage),S.addTabRemovedEventListener(p._handleTabClose),A.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,e))},registerEventCallback:function(e){if(!i(e))throw new Error("Invalid Callback function");p._scamPageFoundCallback=e},setVersion:function(e){if(!t(e))throw new Error("Invalid string");n.setPIIProductVersion(e)},_getSITabInfo:function(e){let t=p._processedTabFields.get(e);return I(t)&&((t=new Map).set(N.WAX_FIELDS_INFO,new Set),t.set(N.WRS_SCAM_RESPONSE,{}),t.set(N.MATCHED_FIELDS,new Set),t.set(N.PII_SUBMISSION_TIMER,0),t.set(N.PII_FLAG,0),t.set(N.PII_SUBMITTED,!1),t.set(N.SCAM_INSIGHT_BLOCK_PAGE_HANDLED,!1),p._processedTabFields.set(e,t)),t},_collectPIIFields:function(t,i){if(T(t)&&_(i)&&!(i.length<=0)){var n=E.performanceReporter.TYPE.COLLECT_PII_FIELDS+":"+Date.now();A.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,n);let e=p._getSITabInfo(t);const a=e.get(N.WAX_FIELDS_INFO);var r=a.size,o=(i.every(e=>a.add(e)),a.size);p._processedTabFields.set(t,e),R.debug("Received WAX fields for tabID : "+t+" arrPIIFields : "+i),R.debug("Processed Tab fields map after wax update : "+t),R.debug(p._processedTabFields.get(t)),r<o&&p._calculateScamInsightRating(t),A.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,n)}},_getMatchedFields:function(e,t){return I(t)||0===t.size||I(e)||0===e.size?new Set:e.has("*")?t:new Set([...e].filter(e=>t.has(e)))},_piiProtoSubmission:function(e,t,i){if(!l.isTelemetryEnabled())return null;let n=u.getPIISUbmissionObj();if(s(n)||I(i)||0===i.size)return null;var r=E.performanceReporter.TYPE.PII_PROTO_SUBMISSION+":"+Date.now(),o=(A.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,r),e.getFullURL()),e=e.getPIIPolID();n.setSiteUrl(o),n.setSubmissionTime(),n.piiSubmissionItem.PII_FLAGS=t,n.piiSubmissionItem.PII_POLICYID=e,n.piiSubmissionItem.FORM_FIELDS=[...i],u.submitShastaPII(n).then(e=>{R.debug("Protobuf submission successful"),a.telemetryWrapper.sendPIISubmissionStatusEvent(E.PII_SUBMISSION_STATUS.SUCCESS)}).catch(function(e){R.debug("Protobuf submission failed - "+e),a.telemetryWrapper.sendPIISubmissionStatusEvent(E.PII_SUBMISSION_STATUS.FAILURE)}),A.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,r)},getBlockPageData:function(e){if(!T(e))return null;let t=p._PIISubmissionInfo.get(e);if(I(t))return null;let i={};const n=t.get(N.WRS_SCAM_RESPONSE);return t.get(N.PII_SUBMITTED)||(p.sendPIISubmission(E.PII_FLAGS.EXIT_SITE,e),t.set(N.PII_SUBMITTED,!0),p._PIISubmissionInfo.set(e,t)),i.url=n.getFullURL(),i.ageScore=n.getPIIAge(),i.prevalenceScore=n.getPIIPop(),i},sendPIISubmission:function(e,t){if(!T(t)||!T(e))return null;if(!(-1!==Object.values(E.PII_FLAGS).indexOf(e)))return null;const i=p._PIISubmissionInfo.get(t);if(I(i))return null;var t=E.performanceReporter.TYPE.SEND_PII_SUBMISSION+":"+Date.now(),n=(A.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,t),i.get(N.WRS_SCAM_RESPONSE)),r=i.get(N.MATCHED_FIELDS);p._piiProtoSubmission(n,e,r),A.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,t)},_sendPIISubmissionSilentRating:function(e){if(!T(e))return null;const t=p._processedTabFields.get(e);if(I(t))return null;var i=t.get(N.WRS_SCAM_RESPONSE),n=t.get(N.MATCHED_FIELDS),r=t.get(N.PII_FLAG);p._piiProtoSubmission(i,r,n),t.set(N.PII_SUBMITTED,!0),p._processedTabFields.set(e,t)},_sendPIISubmissionSilentRatingOnTabClose:function(e){if(!T(e))return null;const t=p._processedTabFields.get(e);if(I(t))return null;var i,n,r;t.get(N.PII_SUBMITTED)||(e=t.get(N.WRS_SCAM_RESPONSE),i=t.get(N.PII_FLAG),n=t.get(N.MATCHED_FIELDS),r=t.get(N.PII_SUBMISSION_TIMER),p._piiProtoSubmission(e,i,n),clearTimeout(r))},_calculateScamInsightRating:function(e){if(!T(e))return null;const t=p._processedTabFields.get(e);if(I(t))return null;var i=t.get(N.WAX_FIELDS_INFO);const n=t.get(N.WRS_SCAM_RESPONSE);if(I(i)||0===i.size||s(n))return null;const r=[E.SCAM_INSIGHT_RESULT.SUSPICIOUS_PAGE,E.SCAM_INSIGHT_RESULT.SUSPICIOUS_NO_BLOCK_PAGE];i=n.getScamRating();if(I(i))throw new Error("ScamInsight rating cannot be null");var o=E.performanceReporter.TYPE.CALCULATE_SCAM_RATING+":"+Date.now();if(A.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,o),r.includes(i))return p._handleCacheResponse(e,n),void R.debug("Handled scam rating from cache for tabId : "+e);switch(n.getPIIEnValue()){case E.WRS_RATINGS.PII_NOT_ENABLED:case E.WRS_RATINGS.UNKNOWN_SITE:break;case E.WRS_RATINGS.PII_ENABLED:case E.WRS_RATINGS.PII_SILENCE:p._handlePIIEnabledRating(e,t)}A.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,o)},_handlePIIEnabledRating:function(t,i){var e=E.performanceReporter.TYPE.HANDLE_PII_RATING+":"+Date.now(),n=(A.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,e),i.get(N.WAX_FIELDS_INFO));const r=i.get(N.WRS_SCAM_RESPONSE);var o=r.getPIIEnValue(),a=new Set(r.getPIIFieldType());if(I(a)||0===a.size)return null;a=p._getMatchedFields(a,n);if(I(a)||0===a.size)return p._updateCachedScamRating(r,E.SCAM_INSIGHT_RESULT.NOT_SUSPICIOUS_PAGE),null;i.set(N.MATCHED_FIELDS,a),p._processedTabFields.set(t,i),R.debug("Processed Tab fields map after matched fields update : "+t),R.debug(p._processedTabFields.get(t));let s=r.getPIIHTTPS();I(s)&&(s=E.PII_POLICY_HTTPS_KEYS.DONTCARE);n=r.getFullURL();let S=c(n);if(I(S)&&(S=E.HTTP_PROTOCOL),o===E.WRS_RATINGS.PII_ENABLED&&s===E.PII_POLICY_HTTPS_KEYS.DONTCARE||o===E.WRS_RATINGS.PII_ENABLED&&s===E.PII_POLICY_HTTPS_KEYS.HTTPS&&S===E.HTTP_PROTOCOL)p._handleScamPageFoundCallback(t,n),p._updateCachedScamRating(r,E.SCAM_INSIGHT_RESULT.SUSPICIOUS_PAGE);else{let e=0;o===E.WRS_RATINGS.PII_ENABLED&&s===E.PII_POLICY_HTTPS_KEYS.HTTPS&&S===E.HTTPS_PROTOCOL&&(e=E.PII_FLAGS.SUPPRESSED_DUE_TO_HTTPS),o===E.WRS_RATINGS.PII_SILENCE&&(e=E.PII_FLAGS.SUPPRESSED_DUE_TO_SILENTMODE),i.get(N.PII_SUBMISSION_TIMER)||(a=setTimeout(p._sendPIISubmissionSilentRating,E.PII_SUBMISSION_TIMEOUT,t),i.set(N.PII_FLAG,e),i.set(N.PII_SUBMISSION_TIMER,a),p._processedTabFields.set(t,i)),p._updateCachedScamRating(r,E.SCAM_INSIGHT_RESULT.SUSPICIOUS_NO_BLOCK_PAGE)}A.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,e)},setWrsResponse:function(t,i){var n=E.performanceReporter.TYPE.SET_WRS_RESPONSE+":"+Date.now();if(A.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,n),!I(t)&&!s(i)){R.debug("WRS response set. TabId : "+t+" url : "+i.fullURL);let e=p._getSITabInfo(t);e.set(N.WRS_SCAM_RESPONSE,i);i=i.getPIIEnValue();i!==E.WRS_RATINGS.PII_ENABLED&&i!==E.WRS_RATINGS.PII_SILENCE||S.getTab(t,function(e){S.sendMessageToTab(e,{id:E.MESSAGES.PROCESS_PAGE_FOR_SCAM_FIELDS,state:E.SCAM_ANALYSIS_STATE.ANALYZE})}),p._processedTabFields.set(t,e),p._calculateScamInsightRating(t),A.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,n)}},deletePIISubmissionInfo:function(e){return T(e)?(t=p._PIISubmissionInfo.get(e),I(t)?null:void p._PIISubmissionInfo.delete(e)):null;var t},_handleTabClose:function(e){if(!T(e))return null;p.deletePIISubmissionInfo(e)},_handleMessage:function(e,t,i){if(!I(e)&&!I(e.id)){var n=S.getTabID(i);switch(e.id){case E.MESSAGES.WAX_FIELDS_FOUND:if(I(e.data))break;var r=e.data;if(r.length<=0)break;p._collectPIIFields(n,r);break;case E.MESSAGES.TOP_FRAME_UNLOADED:r=E.performanceReporter.TYPE.TOP_FRAME_UNLOADED+":"+Date.now();A.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,r);const o=p._processedTabFields.get(n);if(I(o))return;o.get(N.PII_SUBMISSION_TIMER)&&p._sendPIISubmissionSilentRatingOnTabClose(n),p._processedTabFields.delete(n),A.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,r);break;case E.MESSAGES.CAN_ANALYZE_FOR_SCAM:const a=p._processedTabFields.get(n);if(I(a))break;const s=a.get(N.WRS_SCAM_RESPONSE);if(I(s))return;r=s.getPIIEnValue();r!==E.WRS_RATINGS.PII_ENABLED&&r!==E.WRS_RATINGS.PII_SILENCE||t(E.SCAM_ANALYSIS_STATE.ANALYZE)}}},_handleScamPageFoundCallback:function(t,i){if(T(t)&&!a.scamInsightUtility.isURLInViewAnywayCache(i)){const r=p._processedTabFields.get(t);if(!I(r)){i=r.get(N.SCAM_INSIGHT_BLOCK_PAGE_HANDLED);if(!o(i)||!0!==i){var i=r.get(N.MATCHED_FIELDS),n=r.get(N.WRS_SCAM_RESPONSE);R.debug("Scam Page detected : "),R.debug(r),p._scamPageFoundCallback(t);let e=new Map;e.set(N.WRS_SCAM_RESPONSE,n),e.set(N.MATCHED_FIELDS,i),e.set(N.PII_SUBMITTED,!1),p._PIISubmissionInfo.set(t,e),r.set(N.SCAM_INSIGHT_BLOCK_PAGE_HANDLED,!0),p._processedTabFields.set(t,r)}}}},_handleCacheResponse:function(e,t){T(e)&&!I(t)&&t.getScamRating()===E.SCAM_INSIGHT_RESULT.SUSPICIOUS_PAGE&&i(p._scamPageFoundCallback)&&p._handleScamPageFoundCallback(e,t.getFullURL())},_updateCachedScamRating:function(t,i){if(!I(t)&&T(i)){let e=a.cache.ratingForCachedURL(t.getFullURL());I(e)||e.getScamRating()!==i&&(e[E.SCAM_INSIGHT_RATING_KEY]=i,a.cache.updateCacheRatingsForUrl(e))}}};return p.initialize(),p}(e.SymBfw,e.SafeWeb)}(executionContext);