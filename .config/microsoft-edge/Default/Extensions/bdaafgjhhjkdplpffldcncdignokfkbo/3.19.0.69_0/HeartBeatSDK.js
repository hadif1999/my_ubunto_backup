!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.HeartbeatSDK=t():e.HeartbeatSDK=t()}(window,function(){return i={"./source/HBIndex.js":function(D,e,t){"use strict";t.r(e);var r={DATA_SOURCE_OPTIONS:{portal:"WEB_APPLICATION",mobile:"MOBILE_APPLICATION",extension:"BROWSER_EXTENSION"},TELEMETRYSCD:{GOOGLE_ANALYTICS_URL:"https://www.google-analytics.com/collect",REQUEST_TYPE:"POST"},TELEMETRYDEFAULTPARAMETERS:{APPLICATION_NAME:"an",APPLICATION_VERSION:"av",CLIENT_ID:"cid",DATA_SOURCE:"ds",TRACKING_ID:"tid",USER_LANGUAGE:"ul",GOOGLE_ANALYTICS_PROTOCOL_VERSION:"v",ANONYMIZE_IP:"aip",EVENT_CATEGORY:"ec",EVENT_ACTION:"ea",TYPE:"t",CLIENT_ID_CUSTOM_DIMENSION:SymBfw.telemetryConstants.parameters.CUSTOM_DIMENSION2,BROWSER_NAME:SymBfw.telemetryConstants.parameters.CUSTOM_DIMENSION6},TELEMETRY_CONSTANTS:{INSTALL_PING:"Install",HEART_BEAT_PING:"HeartBeat",USER_BASE:"UserBase",EVENT:"event"},CONTAINER_NAME:"HEARTBEAT_SDK_CONTAINER",INSTALL_PING_STATUS_KEY:"installPingStatusKey",INSTALL_NORTON_PING_STATUS_KEY:"nortonInstallPingStatusKey",INSTALL_PING_STATUS:{ALREADY_SENT:"0",SUCCESS:"1",FAILED:"2"},HB_LASTUPDATETIME_KEY:"hbLastUpdateTimeKey",NORTON_HB_LASTUPDATETIME_KEY:"nortonHBLastUpdateTimeKey",HB_POLLING_TIME:18e5,HB_POLLING_TIME_IN_MINUTES:30,HB_TELEMETRY_UNKNOWN:"unknown",HB_TELEMETRY_ENABLED:"enabled",HB_TELEMETRY_DISABLED:"disabled",NORTON_TELEMETRY_PARAMETERS:{PRODUCT:"product",VERSION:"version",ENABLED:"enabled",TRANSPORT:"transport",MODULE:"module",CLIENT_TRIGGER_TIME:"ctt",CLIENT_SENT_TIME:"cst",PING_TYPE:"E"},NORTON_TELEMETRY_CONFIGS:{SEND_ATTEMPTS:1,RETRY_INTERVAL:5e3,PING_TYPES:{INSTALL:"install",HEARTBEAT:"heartbeat"}},HB_ALARM_NAME:"b5c1d0df-513c-4592-aad4-71cb3c603c16"};const{isObject:n,isFunction:a,isString:s}=SymBfw.utils,l=SymBfw.logger["error"];class i{constructor(){this._prodName=null,this._prodVersion=null,this._machineId=null,this._dataSource=null,this._apiKey=null,this._userLang=null,this._retryIntervalMillis=864e5,this.install={},this.install.isInstallPingEnabled=!0,this.install.isFreshInstall=null,this.heartBeat={},this.heartBeat.isHeartBeatPingEnabled=!0,this.heartBeat.heartBeatIntervalInMilliSec=null,this._isLocalStorageNeeded=!1}set prodName(e){this._prodName=e}get prodName(){return this._prodName}set prodVersion(e){this._prodVersion=e}get prodVersion(){return this._prodVersion}set machineId(e){this._machineId=e}get machineId(){return this._machineId}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set dataSource(e){this._dataSource=r.DATA_SOURCE_OPTIONS[e]}get dataSource(){return this._dataSource}set userLanguage(e){this._userLang=e}get userLanguage(){return this._userLang}set retryIntervalMillis(e){this._retryIntervalMillis=e}get retryIntervalMillis(){return this._retryIntervalMillis}set isInstallPingEnabled(e){this.install.isInstallPingEnabled=e}get isInstallPingEnabled(){return this.install.isInstallPingEnabled}set isFreshInstall(e){this.install.isFreshInstall=e}get isFreshInstall(){return this.install.isFreshInstall}set isHeartBeatPingEnabled(e){this.heartBeat.isHeartBeatPingEnabled=e}get isHeartBeatPingEnabled(){return this.heartBeat.isHeartBeatPingEnabled}set heartBeatIntervalInMilliSec(e){this.heartBeat.heartBeatIntervalInMilliSec=e}get heartBeatIntervalInMilliSec(){return this.heartBeat.heartBeatIntervalInMilliSec}set isLocalStorageNeeded(e){this._isLocalStorageNeeded=e}get isLocalStorageNeeded(){return this._isLocalStorageNeeded}set additionalInstallPingParams(e){if(n(e)){for(var[t,i]of Object.entries(e))s(t)||l("custom dimension value should be a string"),a(i)||l(i+" is not a function");this._additionalInstallPingParams=e}}get additionalInstallPingParams(){return this._additionalInstallPingParams}set additionalHeartBeatPingParams(e){if(n(e)){for(var[t,i]of Object.entries(e))s(t)||l("custom dimension value should be a string"),a(i)||l(i+" is not a function");this._additionalHeartBeatPingParams=e}}get additionalHeartBeatPingParams(){return this._additionalHeartBeatPingParams}}class o{async perform(){throw new Error("Derived class needs to implement this function")}}var c=Object.freeze(new class{constructor(){this._container={}}get container(){return this._container.storage}set container(e){this._container.storage=e}get isLocalStorageNeeded(){return this._container.isLocalStorageNeeded}set isLocalStorageNeeded(e){this._container.isLocalStorageNeeded=e}loadContainer(e){return new Promise((n,a)=>{this.isLocalStorageNeeded=e,this.isLocalStorageNeeded?(this.container=window.localStorage,n(!0)):SymBfw.settings.loadSettingsContainer(r.CONTAINER_NAME,!0,(e,t,i)=>{!1!==e&&!SymBfw.utils.isNil(t)||a(i),this.container=t,n(!0)})})}getContainerByName(e){if(SymBfw.utils.isNil(e)||SymBfw.utils.isNil(this.container))throw new Error("Unable to retrieve the container value");return this.isLocalStorageNeeded?this.container.getItem(e):this.container.getObject(e)}setContainerByName(e,t){if(SymBfw.utils.isNil(e)||SymBfw.utils.isNil(this.container))throw new Error("Unable to set the container value");this.isLocalStorageNeeded?this.container.setItem(e,t):this.container.setObject(e,t)}});const _=SymBfw.utils["isNil"],h=r.TELEMETRYDEFAULTPARAMETERS,d=new class{constructor(){this.defaultParameters={},this.prodName=null,this.prodVersion=null,this.machineId=null,this.dataSource=null,this.apiKey=null,this.userLang=null}init(e){if(_(e)||0===Object.keys(e).length)throw new Error("configObj cannot be null");this.prodName=e.prodName,this.prodVersion=e.prodVersion,this.machineId=e.machineId,this.dataSource=e.dataSource,this.apiKey=e.apiKey,this.userLang=e.userLanguage}_constructQueryParams(e){let t="";for(var[i,n]of Object.entries(e))t+=`${i}=${n}&`;return t=t.substring(0,t.length-1)}_constructDefaultParams(){return this.defaultParameters={[h.APPLICATION_NAME]:this.prodName,[h.APPLICATION_VERSION]:this.prodVersion,[h.CLIENT_ID]:this.machineId,[h.DATA_SOURCE]:this.dataSource,[h.TRACKING_ID]:this.apiKey,[h.USER_LANGUAGE]:this.userLang,[h.GOOGLE_ANALYTICS_PROTOCOL_VERSION]:1,[h.ANONYMIZE_IP]:1,[h.TYPE]:r.TELEMETRY_CONSTANTS.EVENT,[h.CLIENT_ID_CUSTOM_DIMENSION]:this.machineId,[h.BROWSER_NAME]:SymBfw.globals.BROWSER},this._constructQueryParams(this.defaultParameters)}async send(e){if(_(e))return Promise.reject("parameters are required for sending telemetry events");t=this._constructDefaultParams(),t+="&"+this._constructQueryParams(e);var t={method:r.TELEMETRYSCD.REQUEST_TYPE,body:t};try{return 200===(await fetch(r.TELEMETRYSCD.GOOGLE_ANALYTICS_URL,t)).status?Promise.resolve("telemetry sent successfully"):Promise.reject("Error in sending telemetry")}catch(e){return Promise.reject("Error in sending telemetry")}}},{alarmHelper:u,utils:{isntNil:g}}=SymBfw;class E extends o{constructor(){super(),this._containerKeyName=null,this._hbPingInterval=null,this._hbPingRetryInterval=null,this._updateInterval=null,this._additionalHeartBeatPingParams=null}_getCurrentUTCTimestamp(){return Math.floor((new Date).getTime())}_checkPingTimeArrived(){var e=JSON.parse(c.getContainerByName(this._containerKeyName));return!!SymBfw.utils.isNil(e)||e+this._hbPingInterval<this._getCurrentUTCTimestamp()}async _constructHeartBeatPing(){const e={[r.TELEMETRYDEFAULTPARAMETERS.EVENT_CATEGORY]:r.TELEMETRY_CONSTANTS.USER_BASE,[r.TELEMETRYDEFAULTPARAMETERS.EVENT_ACTION]:r.TELEMETRY_CONSTANTS.HEART_BEAT_PING};if(g(this._additionalHeartBeatPingParams))for(var[t,i]of Object.entries(this._additionalHeartBeatPingParams))e[t]=await i();return e}async perform(e){if(SymBfw.utils.isEmptyObject(e))throw new Error("HeartBeat ping configuration is empty");if(this._containerKeyName=r.HB_LASTUPDATETIME_KEY,this._hbPingInterval=e.heartBeatIntervalInMilliSec,this._hbPingRetryInterval=e.retryIntervalMillis,this._updateInterval=e.heartBeatIntervalInMilliSec,this._additionalHeartBeatPingParams=e._additionalHeartBeatPingParams||null,e.isHeartBeatPingEnabled)try{await this._sendHeartBeatPing()}catch(e){SymBfw.logger.error("Failed to send the Telemetry")}}async _registerScheduler(){await u.setAlarm(r.HB_ALARM_NAME,{periodInMinutes:r.HB_POLLING_TIME_IN_MINUTES})}async _sendHeartBeatPing(){if(this._checkPingTimeArrived()){var e=await this._constructHeartBeatPing();try{await d.send(e),c.setContainerByName(this._containerKeyName,this._getCurrentUTCTimestamp())}catch(e){SymBfw.logger.debug("Failed to send the Telementry and retry interval set")}}this._registerScheduler()}}const T=SymBfw["utils"];class N extends o{constructor(){super(),this._container=null,this._additionalInstallPingParams=null}get container(){return this._container}set container(e){this._container=e}async perform(e){if(T.isEmptyObject(e))throw new Error("Install Ping configuration is missing");return!!e.isInstallPingEnabled&&(this.container=c,this._canTriggerInstallPing(e)&&(this._additionalInstallPingParams=e._additionalInstallPingParams,await this._sendInstallPing()),!0)}_canTriggerInstallPing(e){e=e.isFreshInstall;let t=!1;var i=this.container.getContainerByName(r.INSTALL_PING_STATUS_KEY);if(T.isNil(i)){if(e)return!0;this.container.setContainerByName(r.INSTALL_PING_STATUS_KEY,r.INSTALL_PING_STATUS.ALREADY_SENT)}else r.INSTALL_PING_STATUS.FAILED===i&&(t=!0);return t}async _sendInstallPing(){var e=await this._constructInstallPing();let t=null;try{await d.send(e),t=r.INSTALL_PING_STATUS.SUCCESS}catch(e){t=r.INSTALL_PING_STATUS.FAILED}finally{this.container.setContainerByName(r.INSTALL_PING_STATUS_KEY,t)}}async _constructInstallPing(){const e={[r.TELEMETRYDEFAULTPARAMETERS.EVENT_CATEGORY]:r.TELEMETRY_CONSTANTS.USER_BASE,[r.TELEMETRYDEFAULTPARAMETERS.EVENT_ACTION]:r.TELEMETRY_CONSTANTS.INSTALL_PING};if(T.isntNil(this._additionalInstallPingParams))for(var[t,i]of Object.entries(this._additionalInstallPingParams))e[t]=await i();return e}}const m=SymBfw["utils"];t=new class{constructor(){this.hbConfigs=null,this.handleSchedulerEvent=this.handleSchedulerEvent.bind(this)}async init(e){if(!(e instanceof i&&this._isValidConfigObj(e)))throw new TypeError("HeartBeat SDK initialization Failed - Invalid Configuration Object");try{var t=e["isLocalStorageNeeded"];await c.loadContainer(t),d.init(e),(new N).perform(e),(new E).perform(e),this._storeHBConfig(e)}catch(e){SymBfw.logger.error("HB initialization Failed :",e.message)}}_storeHBConfig(e){!e.isInstallPingEnabled&&e.isHeartBeatPingEnabled&&(this.hbConfigs=e)}_isValidConfigObj(e){var t=Object.values(e);for(const e in t)if(t[e]instanceof Object){if(!this._isValidConfigObj(t[e]))return!1}else if(m.isNil(t[e]))return!1;return!0}async handleSchedulerEvent(e){e&&e.name&&e.name===r.HB_ALARM_NAME&&(m.isNil(this.hbConfigs)||await this.init(this.hbConfigs))}};SymBfw.alarmHelper.registerAlarmListener(t.handleSchedulerEvent);const{isObject:I,isFunction:S,isString:P}=SymBfw.utils,p=SymBfw.logger["error"];class f{constructor(){this._prodName=null,this._prodVersion=null,this._machineId=null,this._dataSource=null,this._apiKey=null,this._userLanguage=null,this._isLocalStorageNeeded=!1,this._pingIntervalInMillis=null,this._isMOTEnabled=null,this._pingName=null,this._pingData=null}set prodName(e){this._prodName=e}get prodName(){return this._prodName}set prodVersion(e){this._prodVersion=e}get prodVersion(){return this._prodVersion}set machineId(e){this._machineId=e}get machineId(){return this._machineId}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set dataSource(e){this._dataSource=r.DATA_SOURCE_OPTIONS[e]}get dataSource(){return this._dataSource}set userLanguage(e){this._userLanguage=e}get userLanguage(){return this._userLanguage}set isLocalStorageNeeded(e){this._isLocalStorageNeeded=e}get isLocalStorageNeeded(){return this._isLocalStorageNeeded}set pingIntervalInMillis(e){this._pingIntervalInMillis=e}get pingIntervalInMillis(){return this._pingIntervalInMillis}set isMOTEnabled(e){this._isMOTEnabled=e}get isMOTEnabled(){return this._isMOTEnabled}set pingName(e){this._pingName=e}get pingName(){return this._pingName}set pingData(e){this._pingData=e}get pingData(){return this._pingData}set additionalRecurrentPingParams(e){if(I(e)){for(var[t,i]of Object.entries(e))P(t)||p("custom dimension value should be a string"),S(i)||p(i+" is not a function");this._additionalRecurrentPingParams=e}}get additionalRecurrentPingParams(){return this._additionalRecurrentPingParams}}const{isNil:A,isntNil:L,isInteger:y,isString:O,isObject:B,isEmptyObject:R}=SymBfw.utils;class b extends o{constructor(){super(),this._containerKeyName=null,this._hbRecurrentPingInterval=null,this._pingData=null,this._pollTimer=null,this._additionalRecurrentPingParams=null}init(e){if(R(e))throw new Error("recurrentPingConfig cannot be null");if(!y(e._pingIntervalInMillis))throw new Error("ping interval should be an integer");if(!O(e._pingName))throw new Error("invalid ping name");if(!B(e._pingData))throw new Error("invalid ping data");this._hbRecurrentPingInterval=e._pingIntervalInMillis,this._pingData=e._pingData,this._containerKeyName=e._pingName+"_lastupdatetime",this._additionalRecurrentPingParams=e._additionalRecurrentPingParams}async _constructPingData(){const e=this._pingData;if(L(this._additionalRecurrentPingParams))for(var[t,i]of Object.entries(this._additionalRecurrentPingParams))e[t]=await i();return e}_checkPingTimeReached(){var e=JSON.parse(c.getContainerByName(this._containerKeyName));return!!A(e)||e+this._hbRecurrentPingInterval<this._getCurrentUTCTimestamp()}async perform(){this._checkPingTimeReached()&&(this._pingData=await this._constructPingData(),await this._sendTelemetry()),this._pollTimer=setTimeout(()=>{this.perform()},r.HB_POLLING_TIME)}async _sendTelemetry(){try{await d.send(this._pingData),c.setContainerByName(this._containerKeyName,this._getCurrentUTCTimestamp())}catch(e){SymBfw.logger.error("Failed to send the recurrent ping and retry interval set")}}stop(){L(this._pollTimer)&&(clearTimeout(this._pollTimer),this._pollTimer=null)}_getCurrentUTCTimestamp(){return Math.floor((new Date).getTime())}}const{isString:M,isNil:w,isEmptyObject:C}=SymBfw.utils;var v=new class{constructor(){this._pingObjMap={}}async init(){}async createPing(e){if(!(e instanceof f))throw new TypeError("Active vault user ping initialization failed - Invalid Configuration Object");if(w(e._isLocalStorageNeeded)||w(e._pingName))throw new Error("config object values cannot be empty");try{var t=e["isLocalStorageNeeded"];if(await c.loadContainer(t),!C(this._pingObjMap[e._pingName]))throw new Error(e._pingName+" already exists");const i=new b;i.init(e),this._pingObjMap[e._pingName]=i,d.init(e)}catch(e){SymBfw.logger.error("Recurrent Ping Creation Failed :",e.message)}}start(e){if(!M(e))throw new Error("Invalid ping name");const t=this._pingObjMap[e];if(C(t))throw new Error("Invalid ping object");t.perform()}stop(e){if(!M(e))throw new Error("Invalid ping name");const t=this._pingObjMap[e];if(C(t))throw new Error("Invalid ping object");t.stop()}};e.default={hbManager:t,HBConfig:i,HBRecurrentPingConfig:f,hbRecurrentPingManager:v}},0:function(e,t,i){e.exports=i("./source/HBIndex.js")}},n={},a.m=i,a.c=n,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0).default;function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}var i,n});